<html lang="de">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>slidoo</title>
      <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    <link href="http://fonts.googleapis.com/icon?family=Material%20Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,300' rel='stylesheet' type='text/css'>   

    
    <script src="js/login.js"></script>    
    <!--<script charset="utf-8" src="js/spielplatzanlegendesktop.js"></script> -->
    <script charset="utf-8" src="../www/com/apiomat/apiomat.js"></script>
    
  </head>
   <body  ng-app="myApp" ng-controller="PlaylistsCtrl">

     <div class="navbar-fixed"> 

      <nav>
        <div class="nav-wrapper">
         <a href="#" class="brand-logo left">
            <img src="bilder/logo.png" height="32px" >
            slidoo
          </a>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
              <li class="active"><a href="center.html" class="smoothScroll">Alle Spielpl&auml;tze</a></li>
              <li><a href="create.html" class="smoothScroll">Spielplatz erstellen</a></li>
              <li><a href="contact.html" class="smoothScroll">Kontakt</a></li>
              <li><a href="index.html" onklick="logout()">Logout</a>
          </ul>
        </div>
      </nav>
    </div>
<!-- ab hier von playlist kopiert -->
<div class="container">
    
<div>

First Name: <input type="text" ng-model="firstName"><br>
Last Name: <input type="text" ng-model="lastName"><br>
<br>
Full Name: {{firstName + " " + lastName}}

</div>    
    
    
<h1>Alle Spielplätze</h1>
<div ng-repeat="playlist in playlists  | orderBy:'title'"   class="z-depth-2">

      <div class="card">
            <!--div class="card-image waves-effect waves-block waves-light">
              <img class="responsive-image" src="img/{{playlist.bild}}">
            </div-->
            <div class="card-content">
              <span class="card-title activator grey-text text-darken-4">{{playlist.title}}
              </span><br/>
              <p style="float: right"><i class="material-icons" style="">room</i>{{playlist.ort}}</p>
              <p style="">{{playlist.strasse}} {{playlist.hausnummer}}</p>
              <p style="">{{playlist.plz}}</p>
              <p style="">{{playlist.stadtteil}}</p>
              <br/>
              <!--div class="collection">
                <a href="#/app/playlists/{{playlist.id}}" class="collection-item active" style="text-align: center">Spielplatz ansehen</a>
              </div-->
            </div>

      </div>
</div>                     
</div>                     
                   
  </body>
 
  
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../www/js/materialize.min.js"></script>
  
<script> 
var app = angular.module('myApp', []);
app.controller('PlaylistsCtrl', function($scope, $scope, $scope) {
    var user = new Apiomat.User();
    user.setUserName("test23");
    user.setPassword("test23");
    Apiomat.Datastore.configureWithCredentials(user);
 
    var saveCB = {
      onOk: function() {
       
      },
      onError: function(error) {

      }
    };
    user.loadMe({
      onOk: function() {
         $scope.firstName= "John";
    $scope.lastName= "Doe";
    
           avg = 0;
     
    //Array anlegen
    $scope.playlists = [];  
    $scope.arraysums = [];    
    Apiomat.spielplatz.getspielplatzs("", {
    onOk : function(loadedObjs) {
        alert(loadedObjs.length);
    //Now you can do sth with loaded objects (loadedObjs)
    for (i = 0; i < loadedObjs.length; i++) {
        var arrayspielplaetze = loadedObjs[i]["data"];
        //Ausgabe in Konsole
        var name = arrayspielplaetze["name"];
        var strasse = arrayspielplaetze["straße"];
        var nummer = arrayspielplaetze["hausnummer"];
        var stadtteil = arrayspielplaetze["stadtteil"];
        var plz = arrayspielplaetze["plz"];
        var altersgruppe = arrayspielplaetze["altersgruppe"];
        var groesse = arrayspielplaetze["größe"];
        var status = arrayspielplaetze["status"];
        var bild = arrayspielplaetze["hauptbild"];
        var bewertung = arrayspielplaetze["gesamtbewertungsp"];

        var id = arrayspielplaetze["id"];
        
        console.log("Name");
        
        var spid = "bewertungsid == ("+id+")";//document.getElementById("spid").innerHTML ;
        var sum = 0;
        //var avg =0;
        //alert(spid);
          Apiomat.bewertungen.getbewertungens(spid, {
          onOk : function(loadedObjs) {
          //alert(loadedObjs.length);
          for (i = 0; i < loadedObjs.length; i++) {
                var arraybewertungen = loadedObjs[i]["data"];
                //Ausgabe in Konsole
                var bewertungaus = arraybewertungen["gesamtbewertung"];
                sum +=  parseInt(bewertungaus);
          }
          avg = sum/loadedObjs.length;
          console.log(avg);
          //alert(avg);
          $scope.arraysums.push({ avg: avg});
          },


          onError : function(error) {
          //handle error
          }

      })



      $scope.playlists.push({ title: name, bewertung: bewertung, bild: bild, altersgruppe: altersgruppe, groesse: groesse, status: status , plz: plz ,strasse: strasse, stadtteil: stadtteil, hausnummer: nummer, color: '#FF880E', id:id, avg: avg});
        
      }
    },
        
    onError : function(error) {
    }
    });

    var checkExist = setInterval(function() {
           if ($('span.stars2').length) {
              $('span.stars2').stars2();
              clearInterval(checkExist);
           }
        }, 20);
          
    
        $.fn.stars2 = function() {
            return $(this).each(function() {
                $(this).html($('<span />').width(Math.max(0, (Math.min(5, parseFloat($(this).html())))) * 16));
            });
          }         
      },
      onError: function(error) {

        user.save(saveCB);
      }
    });  
    
    
});
  </script>
</html>